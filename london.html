<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>London Explorer — Cool Things To Do</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#0f1733; --panel2:#101a3a; --text:#e8ecff; --muted:#aab3da;
      --line:rgba(255,255,255,.10); --chip:rgba(255,255,255,.08); --chip2:rgba(255,255,255,.12);
      --ok:#4ee7a8; --warn:#ffd36b; --bad:#ff6b8a;
      --shadow: 0 18px 40px rgba(0,0,0,.35);
      --r:18px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--font); color:var(--text);
      background: radial-gradient(1200px 700px at 20% -10%, rgba(78,231,168,.18), transparent 55%),
                  radial-gradient(1000px 700px at 95% 0%, rgba(255,107,138,.18), transparent 55%),
                  radial-gradient(900px 800px at 40% 120%, rgba(120,160,255,.16), transparent 55%),
                  var(--bg);
    }
    a{color:inherit}
    .wrap{max-width:1200px; margin:0 auto; padding:26px 18px 42px}
    header{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
      margin-bottom:16px;
    }
    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    h1{margin:0; font-size:28px; letter-spacing:.2px}
    .sub{color:var(--muted); max-width:56ch; line-height:1.35}
    .meta{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      background:rgba(255,255,255,.05); border:1px solid var(--line);
      padding:10px 12px; border-radius:999px;
    }
    .pill{display:inline-flex; align-items:center; gap:8px; color:var(--muted); font-size:13px}
    .dot{width:8px; height:8px; border-radius:50%; background:var(--ok); box-shadow:0 0 0 3px rgba(78,231,168,.15)}
    .grid{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .panel .inner{padding:14px}
    .controls{
      display:grid;
      grid-template-columns: 1.25fr .9fr .9fr .7fr;
      gap:10px;
    }
    @media (max-width: 980px){
      .controls{grid-template-columns: 1fr 1fr}
    }
    @media (max-width: 560px){
      .controls{grid-template-columns:1fr}
    }
    .field{
      display:flex; flex-direction:column; gap:6px;
    }
    label{font-size:12px; color:var(--muted)}
    input, select{
      width:100%;
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      outline:none;
    }
    input:focus, select:focus{border-color: rgba(78,231,168,.45); box-shadow:0 0 0 4px rgba(78,231,168,.12)}
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
    .chip{
      cursor:pointer;
      user-select:none;
      background:var(--chip);
      border:1px solid var(--line);
      color:var(--muted);
      padding:8px 10px;
      border-radius:999px;
      font-size:13px;
      display:inline-flex; align-items:center; gap:8px;
      transition:.15s transform, .15s background, .15s color, .15s border-color;
    }
    .chip:hover{transform:translateY(-1px); background:var(--chip2); color:var(--text)}
    .chip.active{background:rgba(78,231,168,.14); border-color:rgba(78,231,168,.35); color:var(--text)}
    .chip small{opacity:.9; color:var(--muted)}
    .toolbar{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding:10px 14px;
      border-top:1px solid var(--line);
      background:rgba(0,0,0,.10);
      flex-wrap:wrap;
    }
    .btn{
      cursor:pointer;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:9px 11px;
      border-radius:12px;
      font-size:13px;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{background:rgba(255,255,255,.10)}
    .btn.primary{
      background:rgba(78,231,168,.16);
      border-color:rgba(78,231,168,.35);
    }
    .btn.danger{
      background:rgba(255,107,138,.14);
      border-color:rgba(255,107,138,.35);
    }
    .count{color:var(--muted); font-size:13px}
    .cards{
      padding:14px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width: 700px){
      .cards{grid-template-columns:1fr}
    }
    .card{
      background:rgba(255,255,255,.05);
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      display:flex; flex-direction:column;
      min-height:150px;
    }
    .cardTop{
      padding:12px 12px 10px;
      display:flex; justify-content:space-between; gap:10px;
    }
    .card h3{margin:0; font-size:16px; line-height:1.25}
    .card p{margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.35}
    .badges{display:flex; gap:6px; flex-wrap:wrap; margin-top:8px}
    .badge{
      font-size:12px; color:var(--muted);
      padding:5px 8px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.12);
    }
    .badge.good{border-color:rgba(78,231,168,.25); background:rgba(78,231,168,.10)}
    .badge.warn{border-color:rgba(255,211,107,.25); background:rgba(255,211,107,.10)}
    .badge.kind{border-color:rgba(120,160,255,.25); background:rgba(120,160,255,.10)}
    .cardBot{
      margin-top:auto;
      padding:10px 12px 12px;
      border-top:1px solid var(--line);
      display:flex; gap:8px; justify-content:space-between; align-items:center;
      background:rgba(0,0,0,.10);
    }
    .actions{display:flex; gap:8px; flex-wrap:wrap}
    .link{
      color:var(--text);
      text-decoration:none;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      padding:8px 10px;
      border-radius:12px;
      font-size:13px;
      display:inline-flex; align-items:center; gap:8px;
    }
    .link:hover{background:rgba(255,255,255,.10)}
    .fav{
      cursor:pointer;
      width:36px; height:36px;
      border-radius:12px;
      display:grid; place-items:center;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
    }
    .fav.active{background:rgba(255,211,107,.14); border-color:rgba(255,211,107,.35)}
    .sideHead{
      padding:14px;
      border-bottom:1px solid var(--line);
      background:rgba(0,0,0,.10);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .sideHead h2{margin:0; font-size:16px}
    .sideHead .mini{color:var(--muted); font-size:12px}
    .sideBody{padding:14px}
    .list{display:flex; flex-direction:column; gap:10px}
    .item{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      border-radius:14px;
      padding:10px;
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
    }
    .item b{display:block; font-size:13px; line-height:1.25}
    .item span{display:block; font-size:12px; color:var(--muted); margin-top:4px}
    .x{
      cursor:pointer;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      width:30px; height:30px; border-radius:10px;
      display:grid; place-items:center;
      flex:0 0 auto;
    }
    .empty{color:var(--muted); font-size:13px; line-height:1.4}
    .footerNote{margin-top:12px; color:var(--muted); font-size:12px; line-height:1.4}
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px; padding:2px 6px; border:1px solid var(--line); border-radius:8px;
      background:rgba(0,0,0,.18); color:var(--text);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>London Explorer</h1>
        <div class="sub">
          Search, filter, and save a London-only list of cool places to see and do.
          (Starter dataset included — add your own in the code.)
        </div>
      </div>
      <div class="meta">
        <div class="pill"><span class="dot"></span> London-only directory</div>
        <div class="pill">Tips: <span class="kbd">/</span> focuses search · <span class="kbd">f</span> toggles favorites view</div>
      </div>
    </header>

    <div class="grid">
      <!-- Main panel -->
      <section class="panel" aria-label="Places">
        <div class="inner">
          <div class="controls">
            <div class="field">
              <label for="q">Search</label>
              <input id="q" placeholder="Try: cemetery, Soho, neon, Roman, market…" autocomplete="off" />
            </div>
            <div class="field">
              <label for="neighborhood">Area</label>
              <select id="neighborhood">
                <option value="">All areas</option>
              </select>
            </div>
            <div class="field">
              <label for="kind">Type</label>
              <select id="kind">
                <option value="">All types</option>
              </select>
            </div>
            <div class="field">
              <label for="sort">Sort</label>
              <select id="sort">
                <option value="recommended">Recommended</option>
                <option value="name">Name (A→Z)</option>
                <option value="free">Free-first</option>
              </select>
            </div>
          </div>

          <div class="chips" id="chips"></div>
        </div>

        <div class="toolbar">
          <div class="count" id="count">—</div>
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <button class="btn" id="toggleFavs" title="Show only favorites (shortcut: f)">⭐ Favorites</button>
            <button class="btn" id="clearFilters">Reset filters</button>
            <button class="btn primary" id="exportItin">Export itinerary</button>
          </div>
        </div>

        <div class="cards" id="cards"></div>
      </section>

      <!-- Side panel -->
      <aside class="panel" aria-label="Itinerary">
        <div class="sideHead">
          <div>
            <h2>My Itinerary</h2>
            <div class="mini" id="itinMeta">0 saved</div>
          </div>
          <button class="btn danger" id="clearItin">Clear</button>
        </div>
        <div class="sideBody">
          <div class="list" id="itin"></div>
          <div class="footerNote">
            Pro tip: Use this as your “shortlist,” then click <b>Map</b> to cluster stops by area.
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
/**
 * London Explorer — single-file app
 * - No external libs
 * - Data lives in PLACES
 * - Favorites + itinerary stored in localStorage
 */

const PLACES = [

  // --- ICONIC / MUST-DO ---
  {id:"towerbridge", name:"Tower Bridge Walkway", area:"Tower Hill", kind:"Views & Landmarks", tags:["views","historic","photos"], blurb:"Classic London skyline shots from the bridge + glass floor walkway.", free:false, time:"1–2h", mapQuery:"Tower Bridge"},
  {id:"westminster", name:"Westminster Abbey (exterior + area)", area:"Westminster", kind:"Views & Landmarks", tags:["historic","photos","walk"], blurb:"Even if you don’t go inside, the surrounding area is peak London.", free:true, time:"Quick", mapQuery:"Westminster Abbey"},
  {id:"buckingham", name:"Buckingham Palace (front gates)", area:"Westminster", kind:"Views & Landmarks", tags:["historic","photos","walk"], blurb:"Quick iconic stop—pair with St James’s Park after.", free:true, time:"Quick", mapQuery:"Buckingham Palace"},
  {id:"stpauls", name:"St Paul’s Cathedral (viewpoints nearby)", area:"City of London", kind:"Views & Landmarks", tags:["views","historic","photos"], blurb:"Go for the dome views from Millennium Bridge / One New Change rooftop.", free:true, time:"1–2h", mapQuery:"St Paul's Cathedral"},
  {id:"millenniumbridge", name:"Millennium Bridge", area:"City of London", kind:"Architecture & Streets", tags:["views","walk","photos"], blurb:"Best pedestrian bridge for skyline shots—especially at golden hour.", free:true, time:"Quick", mapQuery:"Millennium Bridge London"},
  {id:"tate_modern", name:"Tate Modern", area:"Bankside", kind:"Museums & Collections", tags:["indoor","art","views"], blurb:"Modern art + a great free museum. Don’t miss the viewing level.", free:true, time:"Half-day", mapQuery:"Tate Modern"},
  {id:"british_museum", name:"The British Museum", area:"Bloomsbury", kind:"Museums & Collections", tags:["indoor","history","free"], blurb:"World-class collections. Go early to avoid crowds.", free:true, time:"Half-day", mapQuery:"British Museum"},
  {id:"national_gallery", name:"National Gallery", area:"Trafalgar Square", kind:"Museums & Collections", tags:["indoor","art","free"], blurb:"Classic art in the center of everything.", free:true, time:"1–2h", mapQuery:"National Gallery London"},
  {id:"vanda", name:"V&A (Victoria and Albert Museum)", area:"South Kensington", kind:"Museums & Collections", tags:["indoor","art","design","free"], blurb:"Design, fashion, decor—one of London’s best.", free:true, time:"Half-day", mapQuery:"Victoria and Albert Museum"},
  {id:"natural_history", name:"Natural History Museum", area:"South Kensington", kind:"Museums & Collections", tags:["indoor","free","family"], blurb:"Dinosaurs + iconic building. Great rainy-day stop.", free:true, time:"Half-day", mapQuery:"Natural History Museum London"},
  {id:"science_museum", name:"Science Museum", area:"South Kensington", kind:"Museums & Collections", tags:["indoor","free"], blurb:"Hands-on science and tech history.", free:true, time:"Half-day", mapQuery:"Science Museum London"},
  {id:"hydepark", name:"Hyde Park", area:"Hyde Park", kind:"Parks & Gardens", tags:["walk","picnic","free"], blurb:"Classic London park—easy to pair with Kensington.", free:true, time:"Half-day", mapQuery:"Hyde Park London"},
  {id:"regents_park", name:"Regent’s Park + Queen Mary’s Gardens", area:"Regent’s Park", kind:"Parks & Gardens", tags:["walk","photos","free"], blurb:"One of the prettiest parks—especially in bloom season.", free:true, time:"Half-day", mapQuery:"Regent's Park London"},
  {id:"primrose", name:"Primrose Hill", area:"Primrose Hill", kind:"Views & Landmarks", tags:["views","sunset","walk"], blurb:"Quick uphill walk for a perfect skyline view.", free:true, time:"1–2h", mapQuery:"Primrose Hill"},
  {id:"hampsteadheath", name:"Hampstead Heath (Parliament Hill)", area:"Hampstead", kind:"Parks & Gardens", tags:["views","picnic","sunset"], blurb:"Big nature energy + one of the best city views.", free:true, time:"Half-day", mapQuery:"Parliament Hill Hampstead Heath"},
  {id:"greenwich", name:"Greenwich Park + Meridian Line area", area:"Greenwich", kind:"Parks & Gardens", tags:["views","history","walk"], blurb:"Royal park + maritime history + great views of Canary Wharf.", free:true, time:"Half-day", mapQuery:"Greenwich Park"},
  {id:"sky_garden", name:"Sky Garden", area:"City of London", kind:"Views & Landmarks", tags:["views","reservations","photos"], blurb:"Free indoor garden viewpoint—book ahead.", free:true, time:"1–2h", mapQuery:"Sky Garden London"},
  {id:"one_new_change", name:"One New Change Rooftop", area:"City of London", kind:"Views & Landmarks", tags:["views","free","photos"], blurb:"Free rooftop view facing St Paul’s dome.", free:true, time:"Quick", mapQuery:"One New Change rooftop"},
  {id:"southbank_walk", name:"South Bank Walk (Waterloo → London Bridge)", area:"South Bank", kind:"Walks", tags:["walk","views","night"], blurb:"Best river walk with nonstop sights, snacks, and skyline moments.", free:true, time:"Half-day", mapQuery:"South Bank London"},
  {id:"nottinghill", name:"Notting Hill + Portobello Road", area:"Notting Hill", kind:"Markets", tags:["market","photos","walk"], blurb:"Colorful streets + famous market day vibe.", free:true, time:"Half-day", mapQuery:"Portobello Road Market"},
  {id:"borough_market", name:"Borough Market", area:"Southwark", kind:"Food & Drink", tags:["foodie","market","busy"], blurb:"Legendary food market—come hungry.", free:true, time:"1–2h", mapQuery:"Borough Market"},
  {id:"camden_market", name:"Camden Market", area:"Camden", kind:"Markets", tags:["street-food","shopping","crowds"], blurb:"Big energy, stalls, food, and people-watching.", free:true, time:"Half-day", mapQuery:"Camden Market"},
  {id:"spitalfields", name:"Old Spitalfields Market", area:"Shoreditch", kind:"Markets", tags:["market","foodie","shopping"], blurb:"Great mix of food + shops + vintage nearby.", free:true, time:"1–2h", mapQuery:"Old Spitalfields Market"},
  {id:"columbia_road", name:"Columbia Road Flower Market (Sunday)", area:"Bethnal Green", kind:"Markets", tags:["flowers","photos","sunday"], blurb:"Loud, lively, and iconic Sunday morning.", free:true, time:"1–2h", mapQuery:"Columbia Road Flower Market"},

  // --- HIDDEN / QUIRKY / ATLAS-OBSCURA ENERGY ---
  {id:"stdunstan", name:"St Dunstan-in-the-East (Ruins Garden)", area:"City of London", kind:"Parks & Gardens", tags:["ruins","quiet","photos"], blurb:"A bombed-out church turned into a secret garden.", free:true, time:"Quick", mapQuery:"St Dunstan in the East"},
  {id:"mithraeum", name:"London Mithraeum (Temple of Mithras)", area:"City of London", kind:"History & Ruins", tags:["roman","underground","historic"], blurb:"Ancient Roman temple remains under modern London.", free:true, time:"1–2h", mapQuery:"London Mithraeum"},
  {id:"guildhall_amp", name:"Guildhall Roman Amphitheatre", area:"City of London", kind:"History & Ruins", tags:["roman","quick","underground"], blurb:"A Roman amphitheatre outline hidden under the city.", free:true, time:"Quick", mapQuery:"Guildhall Roman Amphitheatre"},
  {id:"seven_noses", name:"Seven Noses of Soho (scavenger hunt)", area:"Soho", kind:"Street Art & Hidden Finds", tags:["quirky","walk","photos"], blurb:"Find the hidden noses stuck onto buildings around Soho.", free:true, time:"1–2h", mapQuery:"Seven Noses of Soho"},
  {id:"gods_junkyard", name:"God’s Own Junkyard", area:"Walthamstow", kind:"Art & Design", tags:["neon","photos","indoor"], blurb:"Neon sign wonderland—pure photo candy.", free:"unknown", time:"1–2h", mapQuery:"God's Own Junkyard"},
  {id:"novelty_automation", name:"Novelty Automation", area:"Holborn", kind:"Games & Experiences", tags:["indoor","quirky"], blurb:"Satirical arcade machines that are hilarious and strange.", free:false, time:"1–2h", mapQuery:"Novelty Automation London"},
  {id:"viktor_wynd", name:"Viktor Wynd Museum of Curiosities", area:"Hackney", kind:"Museums & Collections", tags:["oddities","indoor","night"], blurb:"Cabinet of curiosities—art + weird objects + vibes.", free:false, time:"1–2h", mapQuery:"Viktor Wynd Museum"},
  {id:"leadenhall", name:"Leadenhall Market", area:"City of London", kind:"Architecture & Streets", tags:["historic","market","photos"], blurb:"Victorian covered market with gorgeous ironwork.", free:true, time:"Quick", mapQuery:"Leadenhall Market"},
  {id:"cecils", name:"Cecil Court", area:"Covent Garden", kind:"Architecture & Streets", tags:["bookshops","walk","photos"], blurb:"Tiny alley packed with bookshops and antiques.", free:true, time:"Quick", mapQuery:"Cecil Court London"},
  {id:"neals_yard", name:"Neal’s Yard", area:"Covent Garden", kind:"Architecture & Streets", tags:["photos","walk"], blurb:"Hidden colorful courtyard—quick and cute.", free:true, time:"Quick", mapQuery:"Neal's Yard London"},
  {id:"postmans", name:"Postman’s Park", area:"City of London", kind:"Parks & Gardens", tags:["quiet","historic"], blurb:"Peaceful park with a memorial to heroic self-sacrifice.", free:true, time:"Quick", mapQuery:"Postman's Park"},
  {id:"little_venice", name:"Little Venice", area:"Paddington", kind:"Walks", tags:["walk","photos","canal"], blurb:"Canalside strolls + boats + cafés.", free:true, time:"1–2h", mapQuery:"Little Venice London"},
  {id:"regents_canal", name:"Regent’s Canal Walk (Little Venice → Camden)", area:"West & North London", kind:"Walks", tags:["walk","canal","free"], blurb:"Scenic canal walk connecting neighborhoods.", free:true, time:"Half-day", mapQuery:"Regent's Canal walk Camden"},

  // --- FOOD & DRINK: MARKETS / ICONIC EATS / FUN SPOTS ---
  {id:"dishoom_covent", name:"Dishoom (Covent Garden)", area:"Covent Garden", kind:"Food & Drink", tags:["foodie"], blurb:"Beloved Bombay café vibe—great for brunch or dinner.", free:false, time:"1–2h", mapQuery:"Dishoom Covent Garden"},
  {id:"padella", name:"Padella", area:"Borough", kind:"Food & Drink", tags:["italian","foodie"], blurb:"Famous fresh pasta spot near Borough Market.", free:false, time:"1–2h", mapQuery:"Padella London"},
  {id:"flat_iron", name:"Flat Iron", area:"Soho", kind:"Food & Drink", tags:["steak","foodie"], blurb:"Affordable steak + fun vibe (multiple locations).", free:false, time:"1–2h", mapQuery:"Flat Iron Soho"},
  {id:"the_breakfast_club", name:"The Breakfast Club", area:"Soho", kind:"Food & Drink", tags:["brunch","foodie"], blurb:"Classic London brunch institution.", free:false, time:"1–2h", mapQuery:"The Breakfast Club Soho"},
  {id:"duck_waffle", name:"Duck & Waffle (views)", area:"City of London", kind:"Food & Drink", tags:["views","foodie"], blurb:"Sky-high dining—great for late-night or sunrise vibes.", free:false, time:"1–2h", mapQuery:"Duck & Waffle"},
  {id:"sketch", name:"Sketch", area:"Mayfair", kind:"Food & Drink", tags:["photos","foodie"], blurb:"Iconic aesthetic spot—very “London Instagram.”", free:false, time:"1–2h", mapQuery:"Sketch London"},
  {id:"mercato_mayfair", name:"Mercato Mayfair", area:"Mayfair", kind:"Food & Drink", tags:["market","indoor","foodie"], blurb:"Food hall inside a former church—super cool interior.", free:true, time:"1–2h", mapQuery:"Mercato Mayfair"},
  {id:"mercato_met", name:"Mercato Metropolitano", area:"Elephant & Castle", kind:"Food & Drink", tags:["market","foodie"], blurb:"Big food market vibe—lots of options.", free:true, time:"1–2h", mapQuery:"Mercato Metropolitano London"},
  {id:"seven_dials_market", name:"Seven Dials Market", area:"Covent Garden", kind:"Food & Drink", tags:["market","foodie"], blurb:"Food hall with solid variety—easy lunch stop.", free:true, time:"1–2h", mapQuery:"Seven Dials Market"},
  {id:"maltby_st", name:"Maltby Street Market (weekends)", area:"Bermondsey", kind:"Food & Drink", tags:["market","foodie"], blurb:"Smaller, local market with great bites.", free:true, time:"1–2h", mapQuery:"Maltby Street Market"},
  {id:"brick_lane_bagel", name:"Brick Lane Beigel Bake", area:"Shoreditch", kind:"Food & Drink", tags:["late-night","foodie"], blurb:"Legendary late-night bagels—classic London snack.", free:false, time:"Quick", mapQuery:"Beigel Bake Brick Lane"},
  {id:"chinatown", name:"Chinatown food crawl", area:"Chinatown", kind:"Food & Drink", tags:["foodie","walk"], blurb:"Pick a few spots and snack your way through.", free:false, time:"1–2h", mapQuery:"Chinatown London"},
  {id:"broadway_market", name:"Broadway Market", area:"Hackney", kind:"Markets", tags:["foodie","walk"], blurb:"Saturday market + cute neighborhood strolls.", free:true, time:"1–2h", mapQuery:"Broadway Market London"},
  {id:"mister_lasagna", name:"La Fromagerie (Marylebone)", area:"Marylebone", kind:"Food & Drink", tags:["foodie"], blurb:"Cheese heaven + gourmet goods + picnic potential.", free:false, time:"Quick", mapQuery:"La Fromagerie Marylebone"},
  {id:"twinings", name:"Twinings Tea Shop", area:"City of London", kind:"Food & Drink", tags:["tea","historic"], blurb:"Tiny historic tea shop—quick and charming.", free:true, time:"Quick", mapQuery:"Twinings Tea Shop London"},

  // --- PUBS / CLASSIC LONDON DRINKS ---
  {id:"churchill_arms", name:"The Churchill Arms", area:"Notting Hill", kind:"Food & Drink", tags:["pub","photos"], blurb:"Most photographed pub exterior—flowers everywhere.", free:true, time:"Quick", mapQuery:"The Churchill Arms London"},
  {id:"the_george", name:"The George Inn", area:"Borough", kind:"Food & Drink", tags:["historic","pub"], blurb:"Historic pub courtyard near London Bridge.", free:true, time:"1–2h", mapQuery:"The George Inn London"},
  {id:"prospect_whitby", name:"The Prospect of Whitby", area:"Wapping", kind:"Food & Drink", tags:["pub","river","historic"], blurb:"Riverside pub with old London vibes.", free:true, time:"1–2h", mapQuery:"Prospect of Whitby"},
  {id:"ye_olde", name:"Ye Olde Cheshire Cheese", area:"Fleet Street", kind:"Food & Drink", tags:["historic","pub"], blurb:"Old-school pub vibe—feels like time travel.", free:true, time:"1–2h", mapQuery:"Ye Olde Cheshire Cheese"},
  {id:"spain", name:"The Spaniards Inn", area:"Hampstead", kind:"Food & Drink", tags:["pub","historic"], blurb:"Classic countryside-feeling pub inside London.", free:true, time:"1–2h", mapQuery:"The Spaniards Inn Hampstead"},

  // --- NEIGHBORHOOD “VIBE” WALKS ---
  {id:"soho_walk", name:"Soho wander + Carnaby Street", area:"Soho", kind:"Walks", tags:["walk","shopping","night"], blurb:"Neon, music history, shops, and people-watching.", free:true, time:"Half-day", mapQuery:"Carnaby Street"},
  {id:"shoreditch_walk", name:"Shoreditch street art walk", area:"Shoreditch", kind:"Street Art & Hidden Finds", tags:["walk","photos"], blurb:"Graffiti, indie shops, and coffee spots—very London cool.", free:true, time:"Half-day", mapQuery:"Shoreditch street art"},
  {id:"covent", name:"Covent Garden (piazza + performers)", area:"Covent Garden", kind:"Walks", tags:["walk","photos"], blurb:"Street performers + shops + easy central stop.", free:true, time:"1–2h", mapQuery:"Covent Garden"},
  {id:"south_kens", name:"South Kensington museum quarter", area:"South Kensington", kind:"Walks", tags:["walk","free","indoor"], blurb:"V&A + Natural History + Science Museum in one zone.", free:true, time:"Half-day", mapQuery:"South Kensington museums"},
  {id:"marylebone", name:"Marylebone High Street stroll", area:"Marylebone", kind:"Walks", tags:["walk","shopping"], blurb:"Cute shops + cafés + chill neighborhood energy.", free:true, time:"1–2h", mapQuery:"Marylebone High Street"},
  {id:"kensington", name:"Kensington Gardens", area:"Kensington", kind:"Parks & Gardens", tags:["walk","free"], blurb:"Lovely park pairing with museums and Hyde Park.", free:true, time:"Half-day", mapQuery:"Kensington Gardens"},
  {id:"st_james", name:"St James’s Park", area:"Westminster", kind:"Parks & Gardens", tags:["walk","photos","free"], blurb:"Most ‘royal’ park—great between Buckingham + Westminster.", free:true, time:"1–2h", mapQuery:"St James's Park"},
  {id:"kew", name:"Kew Gardens", area:"Kew", kind:"Parks & Gardens", tags:["photos","nature"], blurb:"Botanical gardens + glasshouses—worth the trip.", free:false, time:"Half-day", mapQuery:"Kew Gardens"},
  {id:"richmond", name:"Richmond Park (deer spotting)", area:"Richmond", kind:"Parks & Gardens", tags:["nature","walk"], blurb:"Huge park with deer—feels like countryside.", free:true, time:"Half-day", mapQuery:"Richmond Park London"},
  {id:"canary", name:"Canary Wharf (modern skyline walk)", area:"Canary Wharf", kind:"Walks", tags:["views","walk"], blurb:"Modern London skyline—cool contrast to central.", free:true, time:"1–2h", mapQuery:"Canary Wharf"},

  // --- EXTRA MUSEUMS / EXPERIENCES ---
  {id:"imperial_war", name:"Imperial War Museum", area:"Lambeth", kind:"Museums & Collections", tags:["history","indoor","free"], blurb:"Powerful museum—very well done.", free:true, time:"Half-day", mapQuery:"Imperial War Museum London"},
  {id:"design_museum", name:"Design Museum", area:"Kensington", kind:"Museums & Collections", tags:["design","indoor"], blurb:"Modern design exhibits—great if you love branding + products.", free:"unknown", time:"1–2h", mapQuery:"Design Museum London"},
  {id:"tate_britain", name:"Tate Britain", area:"Pimlico", kind:"Museums & Collections", tags:["art","indoor","free"], blurb:"British art across centuries—often less crowded.", free:true, time:"1–2h", mapQuery:"Tate Britain"},
  {id:"sir_john", name:"Sir John Soane’s Museum", area:"Holborn", kind:"Museums & Collections", tags:["quirky","historic","indoor"], blurb:"A magical townhouse museum packed with artifacts.", free:true, time:"1–2h", mapQuery:"Sir John Soane's Museum"},
  {id:"leighton", name:"Leighton House Museum", area:"Kensington", kind:"Museums & Collections", tags:["art","indoor","photos"], blurb:"Insanely beautiful interiors—hidden gem museum.", free:false, time:"1–2h", mapQuery:"Leighton House Museum"},
  {id:"skyline_walkie", name:"Horizon 22 (viewpoint)", area:"City of London", kind:"Views & Landmarks", tags:["views","free"], blurb:"Free high viewpoint (availability varies; check booking).", free:true, time:"1–2h", mapQuery:"Horizon 22 London"},
  {id:"shard_view", name:"The View from The Shard", area:"London Bridge", kind:"Views & Landmarks", tags:["views","photos"], blurb:"Paid iconic viewpoint—amazing at sunset.", free:false, time:"1–2h", mapQuery:"The View from The Shard"},
  {id:"london_eye", name:"London Eye", area:"South Bank", kind:"Views & Landmarks", tags:["views"], blurb:"Touristy but fun if it’s your first time.", free:false, time:"1–2h", mapQuery:"London Eye"},
  {id:"ceremony_guard", name:"Changing of the Guard (timed event)", area:"Westminster", kind:"Games & Experiences", tags:["historic","photos"], blurb:"Check schedule; arrive early for a good view.", free:true, time:"1–2h", mapQuery:"Changing of the Guard London"},
];

// ---- configuration / derived data ----
const TAGS = [
  {key:"unusual", label:"Unusual", hint:"weird/hidden energy"},
  {key:"historic", label:"History", hint:"past + stories"},
  {key:"views", label:"Views", hint:"skyline moments"},
  {key:"foodie", label:"Food", hint:"eat-first planning"},
  {key:"walk", label:"Walkable", hint:"great on foot"},
  {key:"indoor", label:"Indoor", hint:"rain-proof"},
  {key:"photos", label:"Photo Spots", hint:"camera candy"}
];

const LS = {
  favs: "londonExplorer.favs.v1",
  itin: "londonExplorer.itin.v1"
};

const els = {
  q: document.getElementById("q"),
  neighborhood: document.getElementById("neighborhood"),
  kind: document.getElementById("kind"),
  sort: document.getElementById("sort"),
  chips: document.getElementById("chips"),
  cards: document.getElementById("cards"),
  count: document.getElementById("count"),
  toggleFavs: document.getElementById("toggleFavs"),
  clearFilters: document.getElementById("clearFilters"),
  itin: document.getElementById("itin"),
  itinMeta: document.getElementById("itinMeta"),
  clearItin: document.getElementById("clearItin"),
  exportItin: document.getElementById("exportItin")
};

let state = {
  tag: "",
  onlyFavs: false,
  favs: new Set(loadJson(LS.favs, [])),
  itin: loadJson(LS.itin, []) // array of ids
};

function loadJson(key, fallback){
  try{
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : fallback;
  }catch{ return fallback; }
}
function save(){
  localStorage.setItem(LS.favs, JSON.stringify([...state.favs]));
  localStorage.setItem(LS.itin, JSON.stringify(state.itin));
}
function uniq(arr){ return [...new Set(arr)].filter(Boolean).sort((a,b)=>a.localeCompare(b)); }

// ---- init dropdowns ----
function initFilters(){
  const areas = uniq(PLACES.map(p=>p.area));
  const kinds = uniq(PLACES.map(p=>p.kind));

  for(const a of areas){
    const opt = document.createElement("option");
    opt.value = a; opt.textContent = a;
    els.neighborhood.appendChild(opt);
  }
  for(const k of kinds){
    const opt = document.createElement("option");
    opt.value = k; opt.textContent = k;
    els.kind.appendChild(opt);
  }
}

// ---- chips ----
function initChips(){
  TAGS.forEach(t=>{
    const el = document.createElement("div");
    el.className = "chip";
    el.dataset.key = t.key;
    el.innerHTML = `<span>${t.label}</span> <small>${t.hint}</small>`;
    el.addEventListener("click", ()=>{
      state.tag = (state.tag === t.key) ? "" : t.key;
      render();
    });
    els.chips.appendChild(el);
  });
}

// ---- filtering logic ----
function matches(place){
  const q = els.q.value.trim().toLowerCase();
  const area = els.neighborhood.value;
  const kind = els.kind.value;

  if(area && place.area !== area) return false;
  if(kind && place.kind !== kind) return false;

  if(state.onlyFavs && !state.favs.has(place.id)) return false;

  if(state.tag){
    const tags = (place.tags || []).map(x=>String(x).toLowerCase());
    // A few tags are semantic
    if(state.tag === "unusual"){
      const unusualWords = ["oddities","quirky","scavenger-hunt","neon","underground","weird"];
      if(!tags.some(t=>unusualWords.includes(t))) return false;
    } else if(state.tag === "historic"){
      const histWords = ["historic","roman","ancient","history","victorian","ruins"];
      if(!tags.some(t=>histWords.includes(t))) return false;
    } else if(state.tag === "views"){
      if(!tags.includes("views")) return false;
    } else if(state.tag === "foodie"){
      const foodWords = ["foodie","street-food","tea","market"];
      if(!tags.some(t=>foodWords.includes(t))) return false;
    } else if(state.tag === "walk"){
      if(!tags.includes("walk") && place.kind !== "Walks") return false;
    } else if(state.tag === "indoor"){
      if(!tags.includes("indoor") && place.kind !== "Museums & Collections" && place.kind !== "Games & Experiences") return false;
    } else if(state.tag === "photos"){
      if(!tags.includes("photos")) return false;
    }
  }

  if(q){
    const hay = `${place.name} ${place.area} ${place.kind} ${(place.tags||[]).join(" ")} ${place.blurb}`.toLowerCase();
    if(!hay.includes(q)) return false;
  }
  return true;
}

function sortPlaces(list){
  const mode = els.sort.value;
  const copy = [...list];
  if(mode === "name"){
    copy.sort((a,b)=>a.name.localeCompare(b.name));
  } else if(mode === "free"){
    const scoreFree = v => (v === true ? 0 : (v === "unknown" ? 1 : 2));
    copy.sort((a,b)=> scoreFree(a.free)-scoreFree(b.free) || a.name.localeCompare(b.name));
  } else {
    // recommended: favorites first, then quicker wins, then name
    const favScore = p => state.favs.has(p.id) ? 0 : 1;
    const timeScore = p => (p.time==="Quick"?0:(p.time==="1–2h"?1:2));
    copy.sort((a,b)=> favScore(a)-favScore(b) || timeScore(a)-timeScore(b) || a.name.localeCompare(b.name));
  }
  return copy;
}

// ---- rendering ----
function render(){
  // chips active state
  [...els.chips.children].forEach(ch=>{
    ch.classList.toggle("active", ch.dataset.key === state.tag);
  });
  els.toggleFavs.classList.toggle("primary", state.onlyFavs);

  const filtered = sortPlaces(PLACES.filter(matches));
  els.count.textContent = `${filtered.length} place${filtered.length===1?"":"s"} shown`;

  els.cards.innerHTML = "";
  if(filtered.length === 0){
    const div = document.createElement("div");
    div.className = "empty";
    div.textContent = "No matches. Try clearing filters or searching a broader keyword.";
    els.cards.appendChild(div);
  } else {
    filtered.forEach(p=> els.cards.appendChild(placeCard(p)));
  }

  renderItinerary();
  save();
}

function badge(text, cls){
  const b = document.createElement("span");
  b.className = `badge ${cls||""}`.trim();
  b.textContent = text;
  return b;
}

function placeCard(p){
  const card = document.createElement("div");
  card.className = "card";

  const top = document.createElement("div");
  top.className = "cardTop";

  const left = document.createElement("div");
  const h = document.createElement("h3");
  h.textContent = p.name;

  const desc = document.createElement("p");
  desc.textContent = p.blurb;

  const badges = document.createElement("div");
  badges.className = "badges";
  badges.appendChild(badge(p.area, "kind"));
  badges.appendChild(badge(p.kind, "kind"));

  const freeLabel = p.free === true ? "Free" : (p.free === false ? "Paid" : "Cost varies");
  badges.appendChild(badge(freeLabel, p.free === true ? "good" : (p.free === false ? "warn" : "")));
  badges.appendChild(badge(p.time || "—", ""));

  left.appendChild(h);
  left.appendChild(desc);
  left.appendChild(badges);

  const fav = document.createElement("div");
  fav.className = "fav";
  fav.title = "Favorite";
  fav.innerHTML = state.favs.has(p.id) ? "★" : "☆";
  fav.classList.toggle("active", state.favs.has(p.id));
  fav.addEventListener("click", ()=>{
    if(state.favs.has(p.id)) state.favs.delete(p.id);
    else state.favs.add(p.id);
    render();
  });

  top.appendChild(left);
  top.appendChild(fav);

  const bot = document.createElement("div");
  bot.className = "cardBot";

  const actions = document.createElement("div");
  actions.className = "actions";

  const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.mapQuery || (p.name + ", London"))}`;
  const map = document.createElement("a");
  map.className = "link";
  map.href = mapUrl;
  map.target = "_blank";
  map.rel = "noopener";
  map.textContent = "Map";

  const add = document.createElement("button");
  add.className = "btn";
  add.textContent = state.itin.includes(p.id) ? "✓ In itinerary" : "+ Add";
  add.disabled = state.itin.includes(p.id);
  add.addEventListener("click", ()=>{
    if(!state.itin.includes(p.id)){
      state.itin.push(p.id);
      render();
    }
  });

  actions.appendChild(map);
  actions.appendChild(add);

  const rightNote = document.createElement("div");
  rightNote.className = "count";
  rightNote.textContent = (p.tags && p.tags.length) ? `Tags: ${p.tags.slice(0,3).join(", ")}` : "";

  bot.appendChild(actions);
  bot.appendChild(rightNote);

  card.appendChild(top);
  card.appendChild(bot);
  return card;
}

function renderItinerary(){
  els.itin.innerHTML = "";
  const items = state.itin.map(id => PLACES.find(p=>p.id===id)).filter(Boolean);

  els.itinMeta.textContent = `${items.length} saved`;

  if(items.length === 0){
    const div = document.createElement("div");
    div.className = "empty";
    div.textContent = "Add places from the cards to build your shortlist.";
    els.itin.appendChild(div);
    return;
  }

  items.forEach(p=>{
    const row = document.createElement("div");
    row.className = "item";

    const left = document.createElement("div");
    const b = document.createElement("b");
    b.textContent = p.name;
    const s = document.createElement("span");
    s.textContent = `${p.area} • ${p.kind}`;
    left.appendChild(b);
    left.appendChild(s);

    const x = document.createElement("div");
    x.className = "x";
    x.title = "Remove";
    x.textContent = "×";
    x.addEventListener("click", ()=>{
      state.itin = state.itin.filter(id => id !== p.id);
      render();
    });

    row.appendChild(left);
    row.appendChild(x);
    els.itin.appendChild(row);
  });
}

// ---- events ----
els.q.addEventListener("input", render);
els.neighborhood.addEventListener("change", render);
els.kind.addEventListener("change", render);
els.sort.addEventListener("change", render);

els.toggleFavs.addEventListener("click", ()=>{
  state.onlyFavs = !state.onlyFavs;
  render();
});

els.clearFilters.addEventListener("click", ()=>{
  els.q.value = "";
  els.neighborhood.value = "";
  els.kind.value = "";
  els.sort.value = "recommended";
  state.tag = "";
  state.onlyFavs = false;
  render();
});

els.clearItin.addEventListener("click", ()=>{
  state.itin = [];
  render();
});

els.exportItin.addEventListener("click", ()=>{
  const items = state.itin.map(id => PLACES.find(p=>p.id===id)).filter(Boolean);
  const payload = {
    exportedAt: new Date().toISOString(),
    city: "London",
    count: items.length,
    itinerary: items
  };
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "london-itinerary.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

// keyboard shortcuts
document.addEventListener("keydown", (e)=>{
  if(e.key === "/" && document.activeElement !== els.q){
    e.preventDefault();
    els.q.focus();
  }
  if(e.key.toLowerCase() === "f" && document.activeElement !== els.q){
    state.onlyFavs = !state.onlyFavs;
    render();
  }
});

// init
initFilters();
initChips();
render();
</script>
</body>
</html>
